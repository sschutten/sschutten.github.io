<!doctype html><html><head><title>Using the Sync Framework on Windows Phone 7</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/favicon_hu71cff7c6f06c0ce56c441b69c0864ea6_5216_42x0_resize_box_3.png><link rel=stylesheet href=/css/style.css><meta name=description content="Using the Sync Framework on Windows Phone 7"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-xxxxxxxx","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu71cff7c6f06c0ce56c441b69c0864ea6_5216_42x0_resize_box_3.png alt=Logo>Sander Schutten's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/main-logo_hu71cff7c6f06c0ce56c441b69c0864ea6_5216_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=https://sschutten.github.io/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/2021/>2021</a><ul><li><a href=/posts/2021/04/>April</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2019/>2019</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2019/10/>October</a><ul><li><a href=/posts/2019/10/difference-between-apply-to-each-and-for-each-actions/>Difference between Apply to each and For each actions</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2019/09/>September</a><ul><li><a href=/posts/2019/09/intelligent-digital-assitants/>Intelligent chatbots for Microsoft Teams</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2019/08/>August</a><ul><li><a href=/posts/2019/08/edge-multi-profile-with-custom-images/>Custom profile images in Edge</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2018/>2018</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2018/02/>February</a><ul><li><a href=/posts/2018/02/logic-apps-improvement-suggestions/>Logic Apps improvement suggestions</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2018/12/>December</a><ul><li><a href=/posts/2018/12/connect-azure-ad-authenticated-signalr-hub-from-spfx/>Connect to Azure AD secured SignalR Hub from your SPFx code</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2017/>2017</a><ul><li><a href=/posts/2017/11/>November</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2013/>2013</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2013/06/>June</a><ul><li><a href=/posts/2013/06/move-your-development-vm-to-azure/>Move your development VM to Azure</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2012/>2012</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2012/09/>September</a><ul><li><a href=/posts/2012/09/preparing-for-70-484-essentials-of-developing-windows-metro-style-apps-using-c/>Preparing for 70-484: Essentials of Developing Windows Metro style Apps using C#</a></li><li><a href=/posts/2012/09/preparing-for-70-485-advanced-metro-style-app-development-using-c/>Preparing for 70-485: Advanced Metro style App Development using C#</a></li></ul></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/2011/>2011</a><ul class=active><li><i class="fas fa-plus-circle"></i><a href=/posts/2011/08/>August</a><ul><li><a href=/posts/2011/08/lightswitch-custom-ribbon-button/>Lightswitch: custom ribbon button</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2011/07/>July</a><ul><li><a href=/posts/2011/07/windows-phone-7-mango-features/>Windows Phone 7 Mango features</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2011/04/>April</a><ul><li><a href=/posts/2011/04/mix11-boot-camps/>MIX11: Boot Camps</a></li><li><a href=/posts/2011/04/mix11-day-1/>MIX11: Day 1</a></li><li><a href=/posts/2011/04/mix11-day-2/>MIX11: Day 2</a></li><li><a href=/posts/2011/04/mix11-day-3/>MIX11: Day 3</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2011/03/>March</a><ul><li><a href=/posts/2011/03/advanced-mvvm-doing-visual-states-properly/>Advanced MVVM: Doing visual states properly</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/2011/01/>January</a><ul class=active><li><a class=active href=/posts/2011/01/using-the-sync-framework-on-windows-phone-7/>Using the Sync Framework on Windows Phone 7</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2010/>2010</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2010/11/>November</a><ul><li><a href=/posts/2010/11/wcf-ria-services-odata-endpoint-does-not-support-update-or-linq/>WCF RIA Services OData endpoint does NOT support update or LINQ</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2010/12/>December</a><ul><li><a href=/posts/2010/12/building-a-location-aware-windows-phone-7-application-2/>Building a location aware Windows Phone 7 application</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2009/>2009</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2009/01/>January</a><ul><li><a href=/posts/2009/01/mce-guide-editor-source-code/>MCE Guide Editor source code</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/>2008</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/11/>November</a><ul><li><a href=/posts/2008/11/building-vista-media-center-add-ins-dutch/>Building Vista Media Center Add-ins (Dutch)</a></li><li><a href=/posts/2008/11/honk-twice-if-you-see-us/>Honk twice if you see us!</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/10/>October</a><ul><li><a href=/posts/2008/10/better-wssf-solution-structure/>Better WSSF solution structure</a></li><li><a href=/posts/2008/10/consume-wcf-service-using-sharepoint-designer/>Consume WCF service using Sharepoint Designer</a></li><li><a href=/posts/2008/10/day-0-arrived-in-la/>Day 0: arrived in LA</a></li></ul></li><li><a href=/posts/2008/09/>September</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/08/>August</a><ul><li><a href=/posts/2008/08/first-release-of-viddlernet/>First release of Viddler.Net</a></li><li><a href=/posts/2008/08/viddlernet-on-codeplex/>Viddler.Net on Codeplex</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/07/>July</a><ul><li><a href=/posts/2008/07/biztalk-server-capabilities-poster/>BizTalk Server capabilities poster</a></li><li><a href=/posts/2008/07/bizunit-designer/>BizUnit Designer</a></li><li><a href=/posts/2008/07/control-windows-media-center-with-new-windows-sideshow-beta-gadgets/>Control Windows Media Center with New Windows SideShow BETA Gadgets</a></li><li><a href=/posts/2008/07/ext-js/>Ext JS</a></li><li><a href=/posts/2008/07/farpoint-spread-for-biztalk-server-2006/>FarPoint Spread for BizTalk Server 2006</a></li><li><a href=/posts/2008/07/first-look-at-wcf-adapter-for-biztalk-server-2006-r2/>First look at WCF Adapter for BizTalk Server 2006 R2</a></li><li><a href=/posts/2008/07/86/>Home Server campaign</a></li><li><a href=/posts/2008/07/84/>How-To: New ASP.NET 3.5 Extensions Video Screencasts</a></li><li><a href=/posts/2008/07/map-xsstring-to-xsdatetime/>Map xs:string to xs:datetime</a></li><li><a href=/posts/2008/07/microsoft-biztalk-server-performance-optimization-guide/>Microsoft BizTalk Server Performance Optimization Guide</a></li><li><a href=/posts/2008/07/microsoft-loadgen-2007/>Microsoft LoadGen 2007</a></li><li><a href=/posts/2008/07/more-biztalk-posters/>More BizTalk posters</a></li><li><a href=/posts/2008/07/released-biztalk-server-2006-extentions-for-wf/>Released: BizTalk Server 2006 extentions for WF</a></li><li><a href=/posts/2008/07/video-biztalk-services-explained/>Video: BizTalk Services Explained</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/04/>April</a><ul><li><a href=/posts/2008/04/biztalk-server-2006-r3-just-around-the-corner/>BizTalk Server 2006 R3 just around the corner</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/03/>March</a><ul><li><a href=/posts/2008/03/status-update-on-mce-guide-editor/>Status update on MCE Guide Editor</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2008/02/>February</a><ul><li><a href=/posts/2008/02/jonas-butt-the-new-it-talent/>Jonas Butt, the new IT-talent?</a></li><li><a href=/posts/2008/02/63/>Running</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2007/>2007</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2007/06/>June</a><ul><li><a href=/posts/2007/06/devdays-2007-were-you-there/>DevDays 2007, were you there?</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2007/05/>May</a><ul><li><a href=/posts/2007/05/first-release-of-mce-guide-editor/>First release of MCE Guide Editor</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2007/02/>February</a><ul><li><a href=/posts/2007/02/net-magazine-article-published-online/>.Net Magazine article published online</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2007/01/>January</a><ul><li><a href=/posts/2007/01/accessing-flat-file-content-in-orchestration/>Accessing flat file content in orchestration</a></li><li><a href=/posts/2007/01/biztalk-adapter-whitepaper/>BizTalk Adapter whitepaper</a></li><li><a href=/posts/2007/01/biztalk-shell-extension/>BizTalk shell extension</a></li><li><a href=/posts/2007/01/biztalk-troubleshooting-guide/>BizTalk Troubleshooting Guide</a></li><li><a href=/posts/2007/01/mcts-biztalk-server-2006/>MCTS BizTalk Server 2006</a></li><li><a href=/posts/2007/01/pipeline-testing-framework-for-bts06/>Pipeline Testing Framework for BTS06</a></li><li><a href=/posts/2007/01/playing-blog-tag/>Playing Blog-Tag</a></li><li><a href=/posts/2007/01/storing-configuration-inside-sso-database/>Storing configuration inside SSO database</a></li><li><a href=/posts/2007/01/using-bam-api-to-create-related-activities/>Using BAM API to create related activities</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2006/>2006</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2006/11/>November</a><ul><li><a href=/posts/2006/11/add-existing-project-from-web-drama/>Add existing project from web drama</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2006/03/>March</a><ul><li><a href=/posts/2006/03/developing-for-vista-media-center/>Developing for Vista Media Center</a></li><li><a href=/posts/2006/03/html-generator-stylesheet-for-biztalk-2004-maps/>HTML Generator Stylesheet for BizTalk 2004 Maps</a></li><li><a href=/posts/2006/03/increase-xslt-performance-by-using-xlskey/>Increase XSLT performance by using xls:key</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2006/02/>February</a><ul><li><a href=/posts/2006/02/biztalk-load-generation-utility-reloaded/>BizTalk Load Generation Utility reloaded</a></li><li><a href=/posts/2006/02/biztalk-performance-tester-released/>BizTalk Performance Tester released</a></li><li><a href=/posts/2006/02/devdays-7-8-march/>DevDays 7 &amp;amp; 8 March</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2006/01/>January</a><ul><li><a href=/posts/2006/01/happy-new-year/>Happy new year!</a></li><li><a href=/posts/2006/01/identify-node-type-in-xslt/>Identify node type in XSLT</a></li><li><a href=/posts/2006/01/suppress-xml-documentation-warnings-for-a-project/>Suppress XML documentation warnings for a project</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2005/>2005</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/2005/11/>November</a><ul><li><a href=/posts/2005/11/access-message-properties-inside-custom-pipeline-component/>Access message properties inside custom pipeline component</a></li><li><a href=/posts/2005/11/biztalk-server-2006-ctm-released/>BizTalk Server 2006 CTM Released</a></li><li><a href=/posts/2005/11/biztalks-sexy-new-xslt-mapper/>BizTalk&amp;#039;s sexy new XSLT mapper</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2005/10/>October</a><ul><li><a href=/posts/2005/10/biztalk-2006-beta-1/>BizTalk 2006 Beta 1</a></li><li><a href=/posts/2005/10/bizunit-20-released/>BizUnit 2.0 released</a></li><li><a href=/posts/2005/10/joining-the-overloaded-web-log-community/>Joining the overloaded web-log community</a></li><li><a href=/posts/2005/10/workflow-designer-will-substitute-orchestration-designer-in-biztalk-vnext/>Workflow designer will substitute orchestration designer in BizTalk vNext</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2005/12/>December</a><ul><li><a href=/posts/2005/12/load-xmlschemas-from-biztalk-assembly/>Load XmlSchema&amp;#039;s from BizTalk assembly</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://sschutten.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/avatar.jpg alt="Author Image"><h5 class=author-name>Sander Schutten</h5><p>January 21, 2011</p></div><div class=title><h1>Using the Sync Framework on Windows Phone 7</h1></div><div class=post-content id=post-content><p>For a mobile platform, like Windows Phone 7, you may be required to allow an application to work even when there’s no data connection available. Doing so is not that easy. You need to manage state locally, synchronize changed data (one-way or duplex) and maybe even handle conflicts. Luckily Microsoft offers the Sync Framework which makes it easier for you to accomplish this by taking much of the required plumbing out of your hands completely. Currently there’s a community technology preview available of Sync Framework 4 (they skipped version 3 to be in line with other releases), Sync Framework 4 makes it even easier for clients to support synchronization because all synchronization logic has moved to the server.</p><p>The figure below shows the Sync Framework 4 architecture where the blue components are the ones provided by Microsoft and the orange components the ones you need to develop yourself. The Sync Logic block is the part that you can extend to allow for more granular control over de synchronization.</p><p><a href=images/syncfx002.png><img src=images/syncfx002_thumb.png alt=syncfx002 title=syncfx002></a></p><p>For synchronizing data, the Sync Framework makes use of the OData protocol. Since OData is an open standard all kinds of platforms are able to sync data with the Sync Framework. Out of the box the Sync Framework comes with a provider for SQL Server and SQL Azure. On the client the Sync Framework provides components for Isolated Storage so you can use sync without writing a line of code on both Silverlight for the desktop as Silverlight for Windows Phone 7.</p><p>In this article I’m going to demonstrate how to use the Sync Framework in your application for Windows Phone 7 by creating an application to manage a shopping list. As I was using the Sync Framework myself I ran into a couple of problems, so I will add my learnings as well.</p><h2 id=1-prerequisites>1. Prerequisites</h2><p>Before you can use the Microsoft Sync Framework, you need to install the framework itself. To obtain the framework please visit <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=afd89099-d589-423c-9762-78096aa95ac2&amp;displaylang=en">this</a> page and download the file ‘Download Instructions.mht’. Once you open the file you are prompted with two steps. By following the first step you need to answer a few basic feedback questions before you are redirected to the Microsoft Connect site. Once you are transferred to the Microsoft Connect website, click on ‘Downloads’ menu option on the left. You’re now at the download page. Please read the description carefully. It tells you that you need to install the Microsoft Sync Framework 2.1 first before installing the 4.0 CTP. Choose the operating system version that is most appropriate to you. Note that when you’re running the 64-bit version of Windows you need to install the 32-bit redistributables of the Sync Framework 2.1 in order to test in Visual Studio.</p><p>Now you have installed the Microsoft Sync Framework, the next step in this sample is setting up the sample database. To do this, download the following SQL file and open and run it in SQL Server Management Studio. This will create a new database named ‘ShoppingList’ and polulate some sample data.</p><div class=wlWriterEditableSmartContent id=scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:68d314bb-cef1-4845-bcf4-ff9267b0f3ff style=margin:0;display:inline;float:none;padding:0>[ShoppingList.sql.zip](/images/ShoppingList.sql_1.zip)</div>## 2. Generate Sync Configuration<p>The sync configuration describes what data you want synchronized. The configuration contains the name and location of the data store, what entities to synchronize and what filters to apply to the entities so you can limit what data is exchanged over the wire. The configuration is used in the next steps to provision the database and generate client and server code.</p><p>Since the sync configuration is an XML-file it’s off course possible to craft it by hand, but in this case we’re using the ‘SyncSvcUtilHelper’ tool to do it for us. This tool is limited in what it can do, so if you need more control over the configuration file you can always tweak it afterwards.</p><p>The ‘SyncSvcUtilHelper’ tool is a graphical user interface build on top of ‘SyncSvcUtil’ command line tool, which is meant to provision the database and generate code. Generating a sync config isn’t actually a functionality of the ‘SyncSvcUtil’ tool, but for easy of use it’s incorporated in the ‘SyncSvcUtilHelper’ anyway. You find both tools in the ‘bin’ directory of the Microsoft Sync Framework SDK installation directory, which is by default ‘C:Program FilesMicrosoft SDKsMicrosoft Sync Framework4.0bin’ on 32-bit and C:Program Files (x86)Microsoft SDKsMicrosoft Sync Framework4.0bin on 64 bit Windows.</p><p>Once you fire up ‘SyncSvcUtilHelper’ you’re presented with the main screen with 3 options:</p><ol><li>Generate or Edit Sync Configuration</li><li>Provision or Deprovision</li><li>Code Generation</li></ol><p><a href=images/syncfx003.png><img src=images/syncfx003_thumb.png alt=syncfx003 title=syncfx003></a></p><p>By executing all these three steps in this order gives you all you need to be able to sync data between server and a Silverlight-based client. In this case you obviously use the first option to generate the sync configuration. On the first screen specify a file name for the sync configuration file. It’s best to save the configuration file in the same directory as the ‘SyncSvcUtilHelper’ since you’re going to need it in the subsequent steps and the tool defaults to this directory.</p><p><a href=images/syncfx004.png><img src=images/syncfx004_thumb.png alt=syncfx004 title=syncfx004></a></p><p>On the next screen you need to enter the details of the database that you’ll use to sync data with. Click on the Add button to add a new database. Enter the details of your database and click the Save button to add your database. Click the Next button to go to the next screen.</p><p><a href=images/syncfx005.png><img src=images/syncfx005_thumb.png alt=syncfx005 title=syncfx005></a></p><p>In this screen you define the synchronization scopes of our application. A synchronization scope defines what data to synchronize for that scope. You can have multiple scopes for different synchronization purposes. In this case you use just one scope and name it ‘DefaultScope’. To add a scope click the Add button and enter the scope name. For schema name, use ‘dbo’ and make sure you check the box in front of ‘Is Template Scope’ since a template scope allows us to apply filters. Click the Save button and then Next to continue.</p><p><a href=images/syncfx006.png><img src=images/syncfx006_thumb.png alt=syncfx006 title=syncfx006></a></p><p>Here is where you choose what entities (tables) you want to synchronize and on what columns you want to enable filtering. To choose the tables to synchronize, click the ‘Add/Edit’ button. In the new window select the database you’ve configured a few screens back and a list of tables is shown. Select all columns of both tables for syncing and enable filtering on the ‘Id’ column of the ‘User’ table and ‘UserId’ column of the ‘Item’ table. Click the ‘OK’ button to close the window and click the Next button to continue.</p><p>On the first screen you see when you chose step 2, you open the sync configuration file you created before. Since you only have one database and sync scope, they are selected by default, so you can just click the ‘Next’ button to continue.</p><p><a href=images/syncfx007.png><img src=images/syncfx007_thumb.png alt=syncfx007 title=syncfx007></a></p><p>The summary screen shows you the details of the sync configuration that’ll be saved to the file. Once you click the ‘Finish’ button, the file is created and the tool is closed.</p><h2 id=3-provision-the-database>3. Provision the database</h2><p>Open the ‘SyncSvcUtilHelper’ tool again, but this time choose step 2, in which you’ll provision the database. By provisioning the database, additional tables are created for all the tables you configured in the sync configuration file. The additional tables store sync related information so the Sync Framework can calculate diffs and detect conflicts.</p><p>On the first screen you get once you chose step 2, you open the sync configuration file you created before. Since you only have a single sync scope and target database they’re selected by default. Click the ‘Next’ button to start provisioning the database.</p><p><a href=images/syncfx008.png><img src=images/syncfx008_thumb.png alt=syncfx008 title=syncfx008></a></p><p>If provisioning of the database was successful you can close the tool by clicking the ‘Finish’ button.</p><p><a href=images/syncfx009.png><img src=images/syncfx009_thumb.png alt=syncfx009 title=syncfx009></a></p><h2 id=4-create-the-sync-service>4. Create the Sync Service</h2><p>A full Sync Framework solution consists of a Sync Service on the server that speaks OData and an offline context on the client for storing data offline and tracking changes. In this step you’ll create the Sync Service.</p><p>To do so you first need a web application to host the Sync Service. Fire up Visual Studio 2010 and create a blank solution (File > New Project > Blank Solution) and name it ‘ShoppingList’. Then add a new ASP.NET Empty Web Application to the ShoppingList solution, named ‘Web’. Add a reference to ‘Microsoft.Synchronization.Services.dll’ which can be found in the ‘Server’ directory of the Microsoft Sync Framework 4.0 installation directory.</p><p>Now you have an empty web application to host you need to create the sync service. To do this you use the ‘SyncSvcUtilHelper’ tool again, but this time choose step 3. On the screen you’re presented with open the sync configuration file and click the ‘Next’ button.</p><p><a href=images/syncfx010.png><img src=images/syncfx010_thumb.png alt=syncfx010 title=syncfx010></a></p><p>On the ‘Select code generation parameters’ screen, select ‘Server’ as the codegen target. Specify the ‘Web’ directory of your ShoppingList solution as the output directory. You can choose whatever language, namespace and output file prefix you like. I used the parameters as in the screenshot below. Click the ‘Next’ button to start the code generation.</p><p><a href=images/syncfx011.png><img src=images/syncfx011_thumb.png alt=syncfx011 title=syncfx011></a></p><p>If the code generation completed successfully you can close the tool and return to Visual Studio. In the solution explorer, click the button to show all files and include both DefaultScopeEntities.cs and DefaultScopeSyncService.svc.</p><p>Before you can use the Sync Service, you need to change a couple of lines of code. Right click DefaultScopeSyncService.svc and choose ‘View code’. Replace the body of the ‘InitializeService’ method with the following lines of code:</p><p>config.ServerConnectionString = @&ldquo;Data Source=.SQL2008;Initial Catalog=ShoppingList;Integrated Security=True;MultipleActiveResultSets=True&rdquo;; config.SetEnableScope(&ldquo;DefaultScope&rdquo;); config.AddFilterParameterConfiguration(&ldquo;userId&rdquo;, &ldquo;User&rdquo;, &ldquo;@Id&rdquo;, typeof(int)); config.AddFilterParameterConfiguration(&ldquo;userId&rdquo;, &ldquo;Item&rdquo;, &ldquo;@UserId&rdquo;, typeof(int)); config.SetSyncObjectSchema(&ldquo;dbo&rdquo;); config.UseVerboseErrors = true; config.EnableDiagnosticPage = true;</p><p>Lines 1 and 2 define the connection string to the database and which scope to use for synchronization.</p><p>Lines 3 and 4 are used to add a mapping for parameter ‘userId’ to the filters you defined when creating the sync configuration file. By using the same parameter name for both filters, the client only has to provide a single value to be able to filter both tables.</p><p>The lines 6 and 7 are only used for diagnostics and should be turned off in a production environment. UserVerboseErrors enables full errors to be send back to the client in case of an exception. This comes in handy when trying to find out why you’re service isn’t syncing properly. EnableDiagnosticsPage enables a page that shows you whether the basic server configuration is valid. This page is the first thing you check if you want to know if the Sync Service is working.</p><p>Now check if your Sync Service is working by right clicking ‘DefaultScopeSyncService.svc’ and choosing ‘View in browser’. The page should load correctly. Then change the ‘$syncscopes’ parameter in the url to ‘$diag’ and press enter. If all tests passed, except for the ClientAccessPolicy/CrossDomain files, you’re ready to continue to create the Windows Phone 7 client.</p><h2 id=5-create-the-windows-phone-7-client>5. Create the Windows Phone 7 client</h2><p>Add an empty Windows Phone 7 application to the solution. In this example I named it ‘ShoppingList’. Add a reference to ‘Microsoft.Synchronization.ClientServices.dll’ which can be found in the ‘ClientWP7′ directory of the Microsoft Sync Framework 4.0 installation directory. Also add a reference to the Silverlight 3 version of ‘System.ComponentModel.DataAnnotations.dll’. This assembly van be found in C:Program FilesMicrosoft SDKsSilverlightv3.0LibrariesClient (32 bit) or C:Program Files (x86)Microsoft SDKsSilverlightv3.0LibrariesClient (64 bit).</p><p>In order to access the sync service and use the entities, you need to generate the client code. Start the ‘SyncSvcUtilHelper’ tool and follow the same steps as when generating code for the server. This time choose ‘IsolatedStore Client’ as the codegen target and specify the Windows Phone 7 application directory, ‘ShoppingList’. The ‘IsolatedStore Client’ generates code that uses IsolatedStorage for storing the synced entities and can be used for both Silverlight for the desktop as for Windows Phone 7. Click the ‘Next’ button to start the code generation.</p><p><a href=images/syncfx012.png><img src=images/syncfx012_thumb.png alt=syncfx012 title=syncfx012></a></p><p>If the code generation completed successfully you can close the tool and return to Visual Studio. Make sure the Windows Phone 7 project is selected and in the solution explorer, click the button to show all files and include both DefaultScopeEntities.cs and DefaultScopeOfflineContext.cs.</p><p>Now open up MainPage.xaml.cs and replace all the code with the following:</p><p>using System; using Microsoft.Phone.Controls; using Microsoft.Synchronization.ClientServices.IsolatedStorage; namespace ShoppingList { public partial class MainPage : PhoneApplicationPage { private DefaultScope.DefaultScopeOfflineContext context; // Constructor public MainPage() { InitializeComponent(); context = new DefaultScope.DefaultScopeOfflineContext( &ldquo;ShoppingList&rdquo;, new Uri(&ldquo;http://localhost/ShoppingList/DefaultScopeSyncService.svc&rdquo;) ); context.CacheController.ControllerBehavior.AddScopeParameters(&ldquo;userId&rdquo;, &ldquo;1&rdquo;); DataContext = context; context.LoadCompleted += context_LoadCompleted; context.LoadAsync(); } void context_LoadCompleted(object sender, LoadCompletedEventArgs e) { context.CacheController.RefreshAsync(); } private void ApplicationBarIconButton_Click(object sender, EventArgs e) { context.CacheController.RefreshAsync(); } } }</p><p>In lines 16 to 19 the DefaultScopeOfflineContext is initialized with the path in IsolatedStorage to store the offline data and the Uri to the sync service. In line 20 a parameter is added for the userId. For each client parameter name on the server you need to add a scope parameter on the client. In this case there’s just a single client parameter ‘userId’, which is mapped on the server to two table fields. In the sample data in the database there are two users you can try: IDs 1 and 2. In line 21 the DefaultScopeOfflineContext is set as DataContext so you can use it in the XAML bindings. In lines 23 and 24 an event handler for LoadComplete is assigned and the context is asked to load the offline stored data from IsolatedStorage. Once the offline data is loaded, the CacheController is asked to refresh, which calls the sync service to synchronize the offline data with the live data on the server. Once the sync completes, the data in the offline context is in sync with the server data, which is done in line 34.</p><p>Open up MainPage.xaml and add a ListBox to the ContentPanel Grid using the following piece of XAML. This creates a ListBox that binds to the ItemCollection propery of the DefaultScopeOfflineContext which contains the items in your shopping list. A CheckBox is used so you can mark the item as bought.</p><p><a href=phone:PhoneApplicationPage.ApplicationBar>phone:PhoneApplicationPage.ApplicationBar</a> &lt;shell:ApplicationBar IsVisible=&ldquo;True&rdquo; IsMenuEnabled=&ldquo;True&rdquo;> &lt;shell:ApplicationBarIconButton IconUri="/Images/appbar_button1.png" Text=&ldquo;Sync&rdquo; Click=&ldquo;ApplicationBarIconButton_Click&rdquo;/> &lt;/shell:ApplicationBar> &lt;/phone:PhoneApplicationPage.ApplicationBar></p><p>Return to the MainPage.xaml.cs and add the event handler for the ApplicationBar button using the following piece of code. This makes sure any changes made by the user are persisted to the IsolatedStorage first and then start the synchronization.</p><p>private void ApplicationBarIconButton_Click(object sender, EventArgs e) { context.SaveChanges(); context.CacheController.RefreshAsync(); }</p><p>Now your application is ready to test! Make sure the Windows Phone 7 project is marked as startup project and then press ‘F5′ to start debugging. Once the application is started you should soon see a list of shopping list items. Try making changes on the client by marking an item as bought and click the sync button and notice that the IsBought value changed in the database. Also try adding additional items to the Item table in the database and notice the items appear in the list in the Windows Phone 7 client as soon as you click the sync button again.</p><p><a href=images/syncfx013.png><img src=images/syncfx013_thumb.png alt=syncfx013 title=syncfx013></a></p><h2 id=debugging-a-sync-service>Debugging a sync service</h2><p>Having trouble with your sync service, but don’t have a clue what’s wrong? Debugging a sync service is a bit tricky. As you probably noticed during your own investigation, you can handle the RefreshCompleted event of the CacheController, but all you find when inspecting the Error property of the RefreshCompletedEventArgs is a ‘The remote server returned an error: NotFound.’. Before explaining how to do it, here are a few questions I compiled after stepping into a couple of common errors myself:</p><ul><li>Open the Diagnostics page. Do all tests pass?</li><li>Did you provision the database? Re-provisioning doesn’t hurt, so just try it.</li><li>Did you add lines of code to the sync service code behind setting the connection string and sync scope name? When regenerating the server code, this file could be overwritten.</li><li>Did you add filter parameter configurations for all the filter parameters in your sync service config on the server?</li><li>Did you add parameters on the client for each parameter mapping on the server?</li><li>Are the names and types of the filter parameters on the server equal to the GlobalName values in your sync service configuration?</li><li>Does the account under which the sync service runs have access to the database in the connection string?</li><li>Did you specify the correct Uri on the client? Try the Uri in your browser to make sure it is correct.</li></ul><p>If all of the above didn’t help it’s time to start debugging the sync service. For debugging you use a common HTTP-traffic monitor tool called Fiddler2. <a href=http://www.fiddler2.com/Fiddler2/version.asp>Download Fiddler2</a> and install it. Next start Fiddler2 and configure it to allow remote connections, as described in <a href=http://blogs.msdn.com/b/fiddler/archive/2010/10/15/fiddler-and-the-windows-phone-emulator.aspx>this blog post</a>. You should be able to capture the internet traffic of the Windows Phone 7 emulator by now. Make sure you start the emulator <span style=text-decoration:underline>after</span> you started Fiddler2, so if it is running, restart it first. Open internet explorer on the emulator and browse to a particular website. Fiddler2 should show you the internet traffic.</p><p>Since the ASP.NET Development Service doesn’t allow remote connections and the emulator is regarded as a remote device, you need to configure the web application to run in IIS. Note: I assume you’re running Vista or Windows 7 and you already installed IIS 7. Open the properties of the web project and go to the ‘Web’ tab. Select to use the local IIS web server and specify a Url, see example below. Click ‘Create Virtual Directory’ to create the virtual directory if it doesn’t exist yet.</p><p><a href=images/syncfx001.png><img src=images/syncfx001_thumb.png alt=syncfx001 title=syncfx001></a></p><p>Fiddler2 doesn’t capture traffic going to localhost, so in order to capture your sync service traffic go to MainPage.xaml.cs in your Windows Phone 7 application and replace localhost with the computer name in the Uri to the sync service. Make sure the Uri points to the IIS hosted sync service.</p><p>In the DefaultScopeSyncService.svc.cs file in your web project, make sure you enabled UserVerbodeLogging by adding the following line of code:</p><p>config.UseVerboseErrors = true;</p><p>Now, if you encounter a synchonization error, go into Fiddler2 and lookup the faulted web session, which is indicated with status 500. Click the ‘TextView’ button of the response area (bottom right part of the screen) in order to see the plain error message that was transmitted over the wire.</p><p><a href=images/syncfx014.png><img src=images/syncfx014_thumb.png alt=syncfx014 title=syncfx014></a></p><div class=wlWriterEditableSmartContent id=scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:ff7a3168-f14b-4082-b200-e7a7a64adda3 style=margin:0;display:inline;float:none;padding:0>[Download sample project](/images/ShoppingList1.zip)</div></div><div class=btn-improve-page><a href=https://github.com/sschutten/blog/edit/master/content/posts/2011/01/using-the-sync-framework-on-windows-phone-7/index.md target=_blank><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/2011/03/advanced-mvvm-doing-visual-states-properly/ class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Advanced MVVM: Doing visual states properly</div></a></div><div class="col-md-6 next-article"><a href=/posts/2010/12/building-a-location-aware-windows-phone-7-application-2/ class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Building a location aware Windows Phone 7 application</div></a></div></div><hr><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="does-not-exist",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#1-prerequisites>1. Prerequisites</a></li><li><a href=#3-provision-the-database>3. Provision the database</a></li><li><a href=#4-create-the-sync-service>4. Create the Sync Service</a></li><li><a href=#5-create-the-windows-phone-7-client>5. Create the Windows Phone 7 client</a></li><li><a href=#debugging-a-sync-service>Debugging a sync service</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>sander@dotnetstudio.nl</span></li><li><span>Phone:</span> <span>+31 6 3830 4494</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">Copyright © 2021</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>